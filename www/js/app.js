(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var API = '/api/v1/';
var IMG = '/upload/';

if ($('#welcome-page').length === 1 && localStorage.getItem('idUser') !== null) {
    window.location = 'voting.html';
    exit;
}

$('#user-form').submit(function () {
    $.ajax({
        url: API + 'user/register',
        method: 'POST',
        data: { 'name': $('#user-name').val() },
        success: function (response) {
            localStorage.setItem('idUser', response.id);
            window.location = 'rules.html';
        }
    });
    return false;
});

if ($('#wine-list').length === 1) {
    $.ajax({
        url: API + 'wine',
        success: function (response) {
            $.each(response, function (i, wine) {
                addWine(wine);
            });

            $.ajax({
                url: API + 'user/' + localStorage.getItem('idUser') + '/votes',
                success: function (response) {
                    if (response.vote1 !== null) {
                        $('.wine[data-id=' + response.vote1 + '] .btn[data-weight=1]').addClass('active btn-primary');
                    }
                    if (response.vote2 !== null) {
                        $('.wine[data-id=' + response.vote2 + '] .btn[data-weight=2]').addClass('active btn-primary');
                    }
                    if (response.vote3 !== null) {
                        $('.wine[data-id=' + response.vote3 + '] .btn[data-weight=3]').addClass('active btn-primary');
                    }
                },
                error: function () {
                    localStorage.removeItem('idUser');
                    window.location = '/';
                }
            });
        }
    });
}

if ($('#results').length === 1) {
    $.ajax({
        url: API + 'wine/ranking',
        success: function (response) {
            $.each(response, function (i, wine) {
                addResultWine(wine);
            });
        }
    });

    setTimeout(function () {
        location.reload();
    }, 30000);
}

$(document).on('click', '.vote', function () {
    var addVote = !$(this).hasClass('active');
    $(this).toggleClass('active btn-primary');
    var weight = parseInt($(this).attr('data-weight'));
    var idWine = $(this).parents('.wine').attr('data-id');
    $('.vote[data-weight=' + weight + '].active').not(this).each(function (i, vote) {
        $(vote).removeClass('active btn-primary');
        changePoints($(vote).parents('.wine').attr('data-id'), -weight);
    });

    $('.wine[data-id=' + idWine + '] .active').not(this).each(function (i, vote) {
        $(vote).removeClass('active btn-primary');
        var thisWeight = parseInt($(this).attr('data-weight'));
        changePoints($(vote).parents('.wine').attr('data-id'), -thisWeight);

        $.ajax({
            url: API + 'wine/vote' + thisWeight,
            method: 'POST',
            data: {
                idUser: localStorage.getItem('idUser'),
                idWine: null
            }
        });
    });

    changePoints(idWine, addVote ? weight : -weight);

    $.ajax({
        url: API + 'wine/vote' + weight,
        method: 'POST',
        data: {
            idUser: localStorage.getItem('idUser'),
            idWine: addVote ? idWine : null
        }
    });
});

function changePoints(idWine, delta) {
    var pointSpan = $('.wine[data-id=' + idWine + '] .points');
    var currentPoints = parseInt(pointSpan.text());
    var points = currentPoints + delta;
    pointSpan.text(points);
}

function addWine(wine) {
    $('#wine-list').append('<div class="panel panel-default wine" data-id="' + wine.id + '">' + '<div class="panel-heading">' + '<h4>#' + wine.id + ' - ' + wine.name + ' - ' + wine.year + ' ' + '</h4>' + '</div>' + '<div class="panel-body">' + '<a href="' + IMG + wine.picture + '" onclick="window.open(this.href);return false;"><img src="' + IMG + wine.picture + '"></a>' + '</div>' + '<div class="panel-footer">' + '<span class="points">' + wine.points + '</span> <span class="glyphicon glyphicon-heart"></span>' + '<div class="btn-group pull-right fix-pos" role="group" aria-label="...">' + '<button type="button" class="btn btn-default vote" data-weight="3">3 <span class="glyphicon glyphicon-heart"></span></button>' + '<button type="button" class="btn btn-default vote" data-weight="2">2 <span class="glyphicon glyphicon-heart"></span></button>' + '<button type="button" class="btn btn-default vote" data-weight="1">1 <span class="glyphicon glyphicon-heart"></span></button>' + '</div>' + '</div>' + '</div>');
}

function addResultWine(wine) {
    $('#results').append('<div class="panel panel-default wine wine-result">' + '<div class="panel-heading">' + '<h4>#' + wine.id + ' - ' + wine.name + ' - ' + wine.year + ' ' + '</h4>' + '</div>' + '<div class="panel-body">' + '<a href="' + IMG + wine.picture + '" onclick="window.open(this.href);return false;"><img src="' + IMG + wine.picture + '"></a>' + '</div>' + '<div class="panel-footer">' + '<span class="points">' + wine.points + '</span> <span class="glyphicon glyphicon-heart"></span>' + '</div>' + '</div>');
}

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHBcXHNjcmlwdHNcXGFwcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLFlBQVksQ0FBQzs7QUFDYixJQUFJLEdBQUcsR0FBRyxVQUFVLENBQUM7QUFDckIsSUFBSSxHQUFHLEdBQUcsVUFBVSxDQUFDOztBQUVyQixJQUFHLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLFlBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFDO0FBQzFFLFVBQU0sQ0FBQyxRQUFRLEdBQUcsYUFBYSxDQUFDO0FBQ2hDLFFBQUksQ0FBQztDQUNSOztBQUVELENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBVztBQUM5QixLQUFDLENBQUMsSUFBSSxDQUFDO0FBQ0gsV0FBRyxFQUFFLEdBQUcsR0FBRyxlQUFlO0FBQzFCLGNBQU0sRUFBRSxNQUFNO0FBQ2QsWUFBSSxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBQztBQUNyQyxlQUFPLEVBQUUsVUFBUyxRQUFRLEVBQUM7QUFDdkIsd0JBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUM1QyxrQkFBTSxDQUFDLFFBQVEsR0FBRyxZQUFZLENBQUM7U0FDbEM7S0FDSixDQUFDLENBQUM7QUFDSCxXQUFPLEtBQUssQ0FBQztDQUNoQixDQUFDLENBQUM7O0FBRUgsSUFBRyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBQztBQUM1QixLQUFDLENBQUMsSUFBSSxDQUFDO0FBQ0gsV0FBRyxFQUFFLEdBQUcsR0FBRyxNQUFNO0FBQ2pCLGVBQU8sRUFBRSxVQUFTLFFBQVEsRUFBQztBQUN2QixhQUFDLENBQUMsSUFBSSxDQUFD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LEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxHQUMvRCxPQUFPLEdBQ1gsUUFBUSxHQUNSLDBCQUEwQixHQUN0QixXQUFXLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsNkRBQTZELEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsUUFBUSxHQUNwSSxRQUFRLEdBQ1IsNEJBQTRCLEdBQ3hCLHVCQUF1QixHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcseURBQXlELEdBQ3JHLFFBQVEsR0FDWixRQUFRLENBQUMsQ0FBQztDQUNqQiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBBUEkgPSAnL2FwaS92MS8nO1xyXG52YXIgSU1HID0gJy91cGxvYWQvJztcclxuXHJcbmlmKCQoJyN3ZWxjb21lLXBhZ2UnKS5sZW5ndGggPT09IDEgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2lkVXNlcicpICE9PSBudWxsKXtcclxuICAgIHdpbmRvdy5sb2NhdGlvbiA9ICd2b3RpbmcuaHRtbCc7XHJcbiAgICBleGl0O1xyXG59XHJcblxyXG4kKCcjdXNlci1mb3JtJykuc3VibWl0KGZ1bmN0aW9uKCkge1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IEFQSSArICd1c2VyL3JlZ2lzdGVyJyxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBkYXRhOiB7J25hbWUnOiAkKCcjdXNlci1uYW1lJykudmFsKCl9LFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2lkVXNlcicsIHJlc3BvbnNlLmlkKTtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJ3J1bGVzLmh0bWwnO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59KTtcclxuXHJcbmlmKCQoJyN3aW5lLWxpc3QnKS5sZW5ndGggPT09IDEpe1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IEFQSSArICd3aW5lJyxcclxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICQuZWFjaChyZXNwb25zZSwgZnVuY3Rpb24oaSwgd2luZSkge1xyXG4gICAgICAgICAgICAgICAgYWRkV2luZSh3aW5lKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiBBUEkgKyAndXNlci8nICsgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2lkVXNlcicpICsgJy92b3RlcycsXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2Uudm90ZTEgIT09IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcud2luZVtkYXRhLWlkPScgKyByZXNwb25zZS52b3RlMSArICddIC5idG5bZGF0YS13ZWlnaHQ9MV0nKS5hZGRDbGFzcygnYWN0aXZlIGJ0bi1wcmltYXJ5Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnZvdGUyICE9PSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLndpbmVbZGF0YS1pZD0nICsgcmVzcG9uc2Uudm90ZTIgKyAnXSAuYnRuW2RhdGEtd2VpZ2h0PTJdJykuYWRkQ2xhc3MoJ2FjdGl2ZSBidG4tcHJpbWFyeScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25zZS52b3RlMyAhPT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy53aW5lW2RhdGEtaWQ9JyArIHJlc3BvbnNlLnZvdGUzICsgJ10gLmJ0bltkYXRhLXdlaWdodD0zXScpLmFkZENsYXNzKCdhY3RpdmUgYnRuLXByaW1hcnknKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2lkVXNlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuaWYoJCgnI3Jlc3VsdHMnKS5sZW5ndGggPT09IDEpe1xyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IEFQSSArICd3aW5lL3JhbmtpbmcnLFxyXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgJC5lYWNoKHJlc3BvbnNlLCBmdW5jdGlvbihpLCB3aW5lKXtcclxuICAgICAgICAgICAgICAgIGFkZFJlc3VsdFdpbmUod2luZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICB9LCAzMDAwMCk7XHJcbn1cclxuXHJcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcudm90ZScsIGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgYWRkVm90ZSA9ICEkKHRoaXMpLmhhc0NsYXNzKCdhY3RpdmUnKTtcclxuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZSBidG4tcHJpbWFyeScpO1xyXG4gICAgdmFyIHdlaWdodCA9IHBhcnNlSW50KCQodGhpcykuYXR0cignZGF0YS13ZWlnaHQnKSk7XHJcbiAgICB2YXIgaWRXaW5lID0gJCh0aGlzKS5wYXJlbnRzKCcud2luZScpLmF0dHIoJ2RhdGEtaWQnKTtcclxuICAgICQoJy52b3RlW2RhdGEtd2VpZ2h0PScgKyB3ZWlnaHQgKyAnXS5hY3RpdmUnKS5ub3QodGhpcykuZWFjaChmdW5jdGlvbihpLCB2b3RlKXtcclxuICAgICAgICAkKHZvdGUpLnJlbW92ZUNsYXNzKCdhY3RpdmUgYnRuLXByaW1hcnknKTtcclxuICAgICAgICBjaGFuZ2VQb2ludHMoJCh2b3RlKS5wYXJlbnRzKCcud2luZScpLmF0dHIoJ2RhdGEtaWQnKSwgLXdlaWdodCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcud2luZVtkYXRhLWlkPScgKyBpZFdpbmUgKyAnXSAuYWN0aXZlJykubm90KHRoaXMpLmVhY2goZnVuY3Rpb24oaSwgdm90ZSl7XHJcbiAgICAgICAgJCh2b3RlKS5yZW1vdmVDbGFzcygnYWN0aXZlIGJ0bi1wcmltYXJ5Jyk7XHJcbiAgICAgICAgdmFyIHRoaXNXZWlnaHQgPSBwYXJzZUludCgkKHRoaXMpLmF0dHIoJ2RhdGEtd2VpZ2h0JykpO1xyXG4gICAgICAgIGNoYW5nZVBvaW50cygkKHZvdGUpLnBhcmVudHMoJy53aW5lJykuYXR0cignZGF0YS1pZCcpLCAtdGhpc1dlaWdodCk7XHJcblxyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogQVBJICsgJ3dpbmUvdm90ZScgKyB0aGlzV2VpZ2h0LFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgaWRVc2VyOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaWRVc2VyJyksXHJcbiAgICAgICAgICAgICAgICBpZFdpbmU6IG51bGxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY2hhbmdlUG9pbnRzKGlkV2luZSwgYWRkVm90ZSA/IHdlaWdodCA6IC13ZWlnaHQpXHJcblxyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IEFQSSArICd3aW5lL3ZvdGUnICsgd2VpZ2h0LFxyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgaWRVc2VyOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaWRVc2VyJyksXHJcbiAgICAgICAgICAgIGlkV2luZTogYWRkVm90ZSA/IGlkV2luZSA6IG51bGxcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5mdW5jdGlvbiBjaGFuZ2VQb2ludHMoaWRXaW5lLCBkZWx0YSl7XHJcbiAgICB2YXIgcG9pbnRTcGFuID0gJCgnLndpbmVbZGF0YS1pZD0nICsgaWRXaW5lICsgJ10gLnBvaW50cycpO1xyXG4gICAgdmFyIGN1cnJlbnRQb2ludHMgPSBwYXJzZUludChwb2ludFNwYW4udGV4dCgpKTtcclxuICAgIHZhciBwb2ludHMgPSBjdXJyZW50UG9pbnRzICsgZGVsdGE7XHJcbiAgICBwb2ludFNwYW4udGV4dChwb2ludHMpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRXaW5lKHdpbmUpe1xyXG4gICAgJCgnI3dpbmUtbGlzdCcpLmFwcGVuZChcclxuICAgICAgICAnPGRpdiBjbGFzcz1cInBhbmVsIHBhbmVsLWRlZmF1bHQgd2luZVwiIGRhdGEtaWQ9XCInICsgd2luZS5pZCArICdcIj4nICtcclxuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJwYW5lbC1oZWFkaW5nXCI+JyArXHJcbiAgICAgICAgICAgICAgICAnPGg0PiMnICsgd2luZS5pZCArICcgLSAnICsgd2luZS5uYW1lICsgJyAtICcgKyB3aW5lLnllYXIgKyAnICcgK1xyXG4gICAgICAgICAgICAgICAgJzwvaDQ+JyArXHJcbiAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJwYW5lbC1ib2R5XCI+JyArXHJcbiAgICAgICAgICAgICAgICAnPGEgaHJlZj1cIicgKyBJTUcgKyB3aW5lLnBpY3R1cmUgKyAnXCIgb25jbGljaz1cIndpbmRvdy5vcGVuKHRoaXMuaHJlZik7cmV0dXJuIGZhbHNlO1wiPjxpbWcgc3JjPVwiJyArIElNRyArIHdpbmUucGljdHVyZSArICdcIj48L2E+JyArXHJcbiAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJwYW5lbC1mb290ZXJcIj4nICtcclxuICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cInBvaW50c1wiPicgKyB3aW5lLnBvaW50cyArICc8L3NwYW4+IDxzcGFuIGNsYXNzPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1oZWFydFwiPjwvc3Bhbj4nICtcclxuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYnRuLWdyb3VwIHB1bGwtcmlnaHQgZml4LXBvc1wiIHJvbGU9XCJncm91cFwiIGFyaWEtbGFiZWw9XCIuLi5cIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLWRlZmF1bHQgdm90ZVwiIGRhdGEtd2VpZ2h0PVwiM1wiPjMgPHNwYW4gY2xhc3M9XCJnbHlwaGljb24gZ2x5cGhpY29uLWhlYXJ0XCI+PC9zcGFuPjwvYnV0dG9uPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCB2b3RlXCIgZGF0YS13ZWlnaHQ9XCIyXCI+MiA8c3BhbiBjbGFzcz1cImdseXBoaWNvbiBnbHlwaGljb24taGVhcnRcIj48L3NwYW4+PC9idXR0b24+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0IHZvdGVcIiBkYXRhLXdlaWdodD1cIjFcIj4xIDxzcGFuIGNsYXNzPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1oZWFydFwiPjwvc3Bhbj48L2J1dHRvbj4nICtcclxuICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgJzwvZGl2PicgK1xyXG4gICAgICAgICc8L2Rpdj4nKTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkUmVzdWx0V2luZSh3aW5lKXtcclxuICAgICQoJyNyZXN1bHRzJykuYXBwZW5kKFxyXG4gICAgICAgICc8ZGl2IGNsYXNzPVwicGFuZWwgcGFuZWwtZGVmYXVsdCB3aW5lIHdpbmUtcmVzdWx0XCI+JyArXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicGFuZWwtaGVhZGluZ1wiPicgK1xyXG4gICAgICAgICAgICAgICAgJzxoND4jJyArIHdpbmUuaWQgKyAnIC0gJyArIHdpbmUubmFtZSArICcgLSAnICsgd2luZS55ZWFyICsgJyAnICtcclxuICAgICAgICAgICAgICAgICc8L2g0PicgK1xyXG4gICAgICAgICAgICAnPC9kaXY+JyArXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicGFuZWwtYm9keVwiPicgK1xyXG4gICAgICAgICAgICAgICAgJzxhIGhyZWY9XCInICsgSU1HICsgd2luZS5waWN0dXJlICsgJ1wiIG9uY2xpY2s9XCJ3aW5kb3cub3Blbih0aGlzLmhyZWYpO3JldHVybiBmYWxzZTtcIj48aW1nIHNyYz1cIicgKyBJTUcgKyB3aW5lLnBpY3R1cmUgKyAnXCI+PC9hPicgK1xyXG4gICAgICAgICAgICAnPC9kaXY+JyArXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicGFuZWwtZm9vdGVyXCI+JyArXHJcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJwb2ludHNcIj4nICsgd2luZS5wb2ludHMgKyAnPC9zcGFuPiA8c3BhbiBjbGFzcz1cImdseXBoaWNvbiBnbHlwaGljb24taGVhcnRcIj48L3NwYW4+JyArXHJcbiAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAnPC9kaXY+Jyk7XHJcbn1cclxuIl19
